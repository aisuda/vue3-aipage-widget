import e from"lodash/isObject";import t from"react";import{createApp as o,isProxy as r,shallowRef as n,ref as i}from"vue";import s from"vk-uview-ui";import a from"lodash/pick";import d from"lodash/isNumber";import c from"lodash/cloneDeep";import u from"classnames";const l="[vue3-aipage-widget]";function p(e){let t=g.react;if(!e)return t;let o=e.toLowerCase().trim();switch(o){case"jquery":case"jq":o=g.jquery;break;case"vue2":case"vue 2":case"vue2.0":case"vue 2.0":o=g.vue2,console.error("vue3-aipage-widget 不支持 vue2.0 技术栈，请改用aipage-widget支持。");break;case"vue":case"vue3":case"vue 3":case"vue3.0":case"vue 3.0":o=g.vue3;break;default:o=g.react}return o}var g;function f(e){let t=!1;if(!e||!b(e))return!1;const o=e;return o.name?o.id?o.componentId?o.description?!o.tags||Array.isArray(o.tags)&&0===o.tags.length?console.error(`${l}自定义插件注册失败，插件分类（tags）不能为空。`):(o.pluginIcon||(o.pluginIcon="cards-plugin"),o.type||(o.type="element"),t=!0):console.error(`${l}自定义插件注册失败，插件描述（description）不能为空。`):console.error(`${l}自定义插件注册失败，渲染器ID（componentId）不能为空。`):console.error(`${l}自定义插件注册失败，插件ID（id）不能为空。`):console.error(`${l}自定义插件注册失败，插件名称（name）不能为空。`),t}function h(e){let t;if("object"==typeof e)if(Array.isArray(e)){t=[];for(let o in e)t.push(h(e[o]))}else if(null===e)t=null;else if(e.constructor===RegExp)t=e;else{t={};for(let o in e)t[o]=h(e[o])}else t=e;return t}function m(e){return"String"===Object.prototype.toString.call(e).slice(8,-1)}function b(e){let t=!1;return"Object"===Object.prototype.toString.call(e).slice(8,-1)&&(t=!0),t}function y(e){return"NaN"!==parseFloat(String(e)).toString()}function w(e){return e.replace(/-[a-z]/g,(e=>e[1].toUpperCase()))}function k(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}function x(e){return`-${e}`.replace(/(-[A-Za-z0-9])/g,(e=>e.toUpperCase().replace("-","")))}function R(e,t=!0){const o=e&&e.__super?Object.create(e.__super,{__super:{value:e.__super,writable:!1,enumerable:!1}}):Object.create(Object.prototype);return t&&e&&Object.keys(e).forEach((t=>o[t]=e[t])),o}function v(e,t,o=!0){const r=R(e,o);return t&&Object.keys(t).forEach((e=>r[e]=t[e])),r}function S(e){if(f(e)&&window&&window.postMessage){(function(e,t){window&&!window.AIPageEditorCustomPlugins&&(window.AIPageEditorCustomPlugins={});const o=x(e);if(!window.AIPageEditorCustomPlugins[o])return window.AIPageEditorCustomPlugins[o]=t,o;console.error(`${l}注册自定义插件失败，已存在同名插件(${e})。`);return null})(e.id,e)&&(console.info(`${l}触发注册自定义插件(${e.name})事件:`,e),window.postMessage({type:"aipage-editor-register-plugin-event",eventMsg:`${l}注册一个自定义aipage-editor插件`,editorPluginName:e.name,customEditorPlugin:e},"*"))}return e}!function(e){e.react="react",e.vue2="vue2",e.vue3="vue3",e.jquery="jquery"}(g||(g={}));const C=375,$=function(e){return e};function j(e){const t=location.pathname.split("/").slice(0,-1);return t.push(e),t.join("/")}function I(e){const t=+[e][e&&0]/375*C;return Number.isNaN(t)?void 0:`${Math.round(t)}px`}function O(e){const t=+[e][e&&0]/C*375;return Number.isNaN(t)?void 0:`${Math.round(t)}px`}function L(e={}){const t=a(c(e)||{},"backgroundImage","backgroundRepeat","backgroundSize","backgroundPosition","backgroundColor");return e.backgroundImage&&/linear-gradient/g.test(e.backgroundImage)?t.backgroundImage=e.backgroundImage:(e.backgroundColor&&(t.backgroundColor=$(e.backgroundColor)),e.backgroundImage&&(t.backgroundImage=`url('${e.backgroundImage}')`)),t}function P(e={},t,o){const r={},n=[e[`${t}Color`],e.defaultColor];return"default"===t&&(n[0]=e.inverseColor,n.reverse()),o&&(r.borderColor=n[0],n.reverse()),r.backgroundColor=n[0],r.color=n[1],r}function T(e={}){let t=a(c(e)||{},"color","fontFamily","lineHeight","textAlign");return e.bold&&(t.fontWeight="bold"),e.italic&&(t.fontStyle="italic"),e.underline&&(t.textDecoration="underline"),e.lines&&(t.WebkitLineClamp=`${e.lines}`),t.lineHeight&&(t.lineHeight=t.lineHeight>=12?`${parseInt(t.lineHeight,10)}px`:parseInt(t.lineHeight,10)),t.fontSize=I(+e.fontSize),t.letterSpacing=I(+e.letterSpacing),t}function A(e={}){const t=a(c(e)||{},"borderLeftStyle","borderRightStyle","borderTopStyle","borderBottomStyle","borderLeftColor","borderRightColor","borderTopColor","borderBottomColor");return+e.borderTopWidth>0?(t.borderTopWidth=I(+e.borderTopWidth),t.borderTopColor=$(e.borderTopColor)):delete t.borderTopStyle,+e.borderLeftWidth>0?(t.borderLeftWidth=I(+e.borderLeftWidth),t.borderLeftColor=$(e.borderLeftColor)):delete t.borderLeftStyle,+e.borderRightWidth>0?(t.borderRightWidth=I(+e.borderRightWidth),t.borderRightColor=$(e.borderRightColor)):delete t.borderRightStyle,+e.borderBottomWidth>0?(t.borderBottomWidth=I(+e.borderBottomWidth),t.borderBottomColor=$(e.borderBottomColor)):delete t.borderBottomStyle,t.marginTop=I(+e.marginTop),t.marginLeft=I(+e.marginLeft),t.marginRight=I(+e.marginRight),t.marginBottom=I(+e.marginBottom),t.paddingTop=I(+e.paddingTop),t.paddingLeft=I(+e.paddingLeft),t.paddingRight=I(+e.paddingRight),t.paddingBottom=I(+e.paddingBottom),t.borderTopLeftRadius=I(+e.borderTopLeftRadius),t.borderTopRightRadius=I(+e.borderTopRightRadius),t.borderBottomLeftRadius=I(+e.borderBottomLeftRadius),t.borderBottomRightRadius=I(+e.borderBottomRightRadius),t}function B(e={}){let t={};if(e.display&&(t.display=e.display),"flex"===t.display){let o=e.flexSetting||{};t.flexDirection=o.direction||"row",t.alignItems=o.align||"stretch",t.justifyContent=o.justify||"flex-start"}return e.flexSetting?.flexShrink>=0&&(t.flexShrink=+e.flexSetting.flexShrink),e.flexSetting?.flex>=0&&(t.flex=+e.flexSetting.flex),t}function M(e,t){const o=e[t+"Unit"]||"px";return"auto"===o||e[t]<=0?"auto":"px"===o?I(+e[t]):e[t]+o}function E(e){let{style:t={},isFlow:o}=e?.componentProperties||{},r=(t.justification||"top left").split(" "),n={};return o?(n.height=M(t,"height"),n.width=M(t,"width"),n.maxWidth="100%",n.width>0&&(n.flexShrink=0)):(n[r[1]]=+t.x+"px",n[r[0]]=+t.y+"px",n.height=M(t,"height")||"auto",n.width=M(t,"width")||"100%",n.position=t.position||"absolute"),t.opacity>=0&&(n.opacity=+t.opacity/100),t.display&&(n.display=t.display),n}function W(e){e||(e=1);return{paddingTop:100/e+"%"}}function D(e={}){const{angle:t=0,x:o,y:r,blur:n,size:i,color:s,distance:a}=e,c=void 0!==o?o:Math.round(Math.sin(t*(Math.PI/180))*a),u=void 0!==r?r:-Math.round(Math.cos(t*(Math.PI/180))*a);return(o||r||n||i||a)&&d(c)&&d(u)?{boxShadow:`${I(c)} ${I(u)} ${I(n||0)} ${I(i||0)} ${$(s)}`}:{}}function H(e={}){const t=a(c(e)||{},"borderLeftStyle","borderRightStyle","borderTopStyle","borderBottomStyle","borderLeftColor","borderRightColor","borderTopColor","borderBottomColor");return t.borderTopLeftRadius=I(+e.borderTopLeftRadius),t.borderTopRightRadius=I(+e.borderTopRightRadius),t.borderBottomLeftRadius=I(+e.borderBottomLeftRadius),t.borderBottomRightRadius=I(+e.borderBottomRightRadius),t}function N(e){if(!e)return"";let t="",o=e.split("/");return e.includes("/sites/")&&o.splice(3,0,"thumbnails"),t=o.join("/")+".png",t}function U(e){return{top:~e.indexOf("bottom")?"auto":0,bottom:~e.indexOf("top")?"auto":0,left:~e.indexOf("right")?"auto":0,right:~e.indexOf("left")?"auto":0}}function _(e,t){let o=function(e,o){t=t.replace(e,o)},r=function(e){return String(e).length>1?String(e):`0${e}`},n=new Date(e),i=n.getFullYear(),s=n.getMonth()+1,a=n.getDate(),d=n.getHours(),c=n.getMinutes(),u=n.getSeconds();return o(/yyyy/g,String(i)),o(/yy/g,r(i.toString().slice(2))),o(/MM/g,r(s)),o(/M/g,s),o(/dd/g,r(a)),o(/d/g,a),o(/HH/g,r(d)),o(/H/g,d),o(/hh/g,r(d%12)),o(/h/g,d%12),o(/mm/g,r(c)),o(/m/g,c),o(/ss/g,r(u)),o(/s/g,u),t}function z(e,t=!1){const o=864e5;let r=new Date(String(e.getFullYear())+"/01/01"),n=r.getDay()>0?8-r.getDay():1;return n=t?n-1:n,Math.abs(Math.ceil((e.getTime()-r.getTime()-n*o)/o/7))}const F={};function q(e){if(e&&F[e])return F[e];const t=(...t)=>{const o=u(...t);return o&&e?o.replace(/(^|\s)([A-Z])/g,"$1"+e+"$2").replace(/(^|\s)\:/g,"$1"):o||""};return e&&(F[e]=t),t}function Z(e,t){return CSS.supports(e,t)}function Y(e){let{componentProperties:t={},id:o}=e,r=t.style||{};const n=`node-${o}`;let i={root:n,main:`${n} ${r.className||""}`};return Object.keys(r).forEach((e=>{!["font","box","boxShadow","background"].includes(e)&&b(r[e])&&(i[e]=[`${n}-${k(e)}`])})),i}function X(e={}){let t={};return Object.keys(e).forEach((o=>{switch(o){case"box":t=Object.assign(t,A(e.box));break;case"background":t=Object.assign(t,L(e.background));break;case"font":t=Object.assign(t,T(e.font));break;case"lineHeight":t.lineHeight=e[o]>=12?`${parseInt(e[o],10)}px`:parseInt(e[o],10);break;case"boxShadow":t=Object.assign(t,D(e.boxShadow));break;case"opacity":t.opacity=+e[o]/100;break;case"width":t.width=e.autoWidth?"auto":M(e,"width");break;case"flexSetting":t=Object.assign(t,B(e));break;case"height":t.height=M(e,"height");break;default:let r=y(e[o])?+e[o]+"px":e[o];b(e[o])?t=Object.assign(t,{[o]:X(e[o])}):!["x","y","css","lineClamp","columns","flex","scrollX"].includes(o)&&Z(k(o),r)&&(t[o]=y(e[o])?+e[o]+"px":e[o])}})),t}function G(e){const t={};return void 0!==e&&(t.zIndex=+e),t}const J=window.matchMedia?.("(max-width: 768px)").matches;function K(a){if(a&&("function"==typeof a||"object"==typeof a)){class d extends t.Component{domRef;app;vm;isUnmount;constructor(e){super(e),this.domRef=t.createRef(),this.resolveAmisProps=this.resolveAmisProps.bind(this)}componentDidMount(){const{amisData:e,amisFunc:t}=this.resolveAmisProps(),{data:r,...n}=a="function"==typeof a?new a:a;this.app=o({data:()=>v(e,"function"==typeof r?r():r),...n,props:n.props||{}}),this.app&&!this.app.prototype&&(this.app.prototype={}),this.app&&!this.app.filter&&(this.app.filter=()=>{}),this.app.use(s),Object.keys(t).forEach((e=>{this.app.$props[e]=t[e]})),this.vm=this.app.mount(this.domRef.current),this.domRef.current.setAttribute("data-component-id",this.props.id)}componentDidUpdate(){if(!this.isUnmount){const{amisData:e}=this.resolveAmisProps();this.vm&&(Object.keys(e).forEach((t=>{this.vm[t]=e[t]})),this.vm.$forceUpdate())}}componentWillUnmount(){this.isUnmount=!0,this.app.unmount()}resolveAmisProps(){let t={},o={};return Object.keys(this.props).forEach((s=>{const a=this.props[s];"function"==typeof a?t[s]=a:r(a)?o[s]=n(a):e(a)?o[s]=i(a):o[s]=a})),{amisData:o,amisFunc:t}}render(){const{componentProperties:e,node:o}=this.props,r=e&&e.style?e.style:{},n={...E(o||this.props),...X(r)};return t.createElement("div",{ref:this.domRef,style:n})}}return d}}function Q(e,t){if(!e)return;const o={type:"",framework:g.react};if(t&&m(t)?Object.assign(o,{type:t}):Object.assign(o,t),o&&!o.type)console.error(`${l}自定义组件注册失败，自定义组件类型（type）不能为空。`);else{o.framework=p(o.framework);const t={react:e=>e,vue3:K}[o.framework](e);if(window){const e=function(e,t){window&&!window.AIPageEditorCustomRenderers&&(window.AIPageEditorCustomRenderers={});const o=x(e);if(!window.AIPageEditorCustomRenderers[o])return window.AIPageEditorCustomRenderers[o]=t,o;console.error(`${l}注册自定义渲染器失败，已存在同名渲染器类型(${e})。`);return null}(o.type,t);e&&(console.info(`${l}触发注册自定义渲染器(${o.type})事件:`,{type:o.type,component:t,framework:o.framework}),window.postMessage({type:"aipage-editor-register-renderer-event",eventMsg:`${l}注册一个自定义aipage-editor渲染器`,customComponentId:e},"*"))}}}export{g as Framework,k as camelToKebab,R as cloneObject,l as consoleTag,K as createVue3Component,_ as dateFormat,h as deepClone,v as extendObject,U as getAlignModeStyle,L as getBackgroundStyle,H as getBorderRadius,E as getBoxPosition,D as getBoxShadow,A as getBoxStyle,Y as getClasses,B as getFlexStyle,T as getFontStyle,p as getFramework,W as getImageSize,j as getLegacyHref,P as getThemeStyle,N as getVideoThumbnail,z as getWeek,G as getZIndexStyle,f as isEditorPlugin,J as isMobile,y as isNumberFormat,b as isObject,m as isString,Z as isValidCSS,w as kebabToCamel,q as makeClassnames,$ as parseThemeColor,S as registerPlugin,Q as registerRenderer,O as toPx,I as toRpx,M as toWHset,x as transformComponentId,X as transformStyle};
